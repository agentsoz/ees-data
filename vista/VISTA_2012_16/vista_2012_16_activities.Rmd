---
title: "VISTA 2012-16 Activities"
author: "Dhirendra Singh"
output:
  pdf_document: default
  html_document:
    keep_md: no
urlcolor: blue
geometry: "left=1cm,right=1cm,top=3cm,bottom=3cm"
---

# About 
*This document was generated on `r as.character(format(Sys.Date(), format="%B %d, %Y"))`.*

# Input Data


The Victorian Integrated Survey of Travel & Activity (VISTA) 2012-16 data was downloaded from the following URL on 10th May 2019:
```
https://transport.vic.gov.au/-/media/tfv-documents/vista/vista_2012_16_v1_sa1_csv.zip
```

The Zip archive was uncompressed, and the contained CSV files recompressed using GZip giving:
```
./VISTA_2012_16_v1_SA1_CSV/JTW_VISTA12_16_SA1_V1.csv.gz
./VISTA_2012_16_v1_SA1_CSV/S_VISTA12_16_SA1_V1.csv.gz
./VISTA_2012_16_v1_SA1_CSV/H_VISTA12_16_SA1_V1.csv.gz
./VISTA_2012_16_v1_SA1_CSV/P_VISTA12_16_SA1_V1.csv.gz
./VISTA_2012_16_v1_SA1_CSV/JTE_VISTA12_16_sa1_V1.csv.gz
./VISTA_2012_16_v1_SA1_CSV/T_VISTA12_16_SA1_V1.csv.gz
```

# Data Processing

```{r echo=FALSE}
source('./vista_2012_16_functions.R')
vista_csv <- './VISTA_2012_16_v1_SA1_CSV/S_VISTA12_16_SA1_V1.csv.gz'
out_weekday_activities_csv_gz <- './vista_2012_16_extracted_activities_weekday.csv.gz'
out_weekend_activities_csv_gz <- './vista_2012_16_extracted_activities_weekend.csv.gz'
extract_and_write_activities_from(vista_csv, out_weekday_activities_csv_gz, out_weekend_activities_csv_gz)
```

Describe how the activities were extracted here...


```{r echo=FALSE}
source('./vista_2012_16_functions.R')
out_weekday_activities_csv_gz <- './vista_2012_16_extracted_activities_weekday.csv.gz'
out_weekend_activities_csv_gz <- './vista_2012_16_extracted_activities_weekend.csv.gz'
simplify_activities_and_create_groups(out_weekday_activities_csv_gz)
simplify_activities_and_create_groups(out_weekend_activities_csv_gz)


# Then for each person we can actually work out the trip chain as well as
# the duration of each activity (using the start/end times of the connecting trips)
# That would give up an accurate picture of what activities are being done in what time bins

```

Describe how the activities were simplified into greoups here...

```{r echo=FALSE}
source('./vista_2012_16_functions.R')
out_weekday_activities_csv_gz <- './vista_2012_16_extracted_activities_weekday.csv.gz'
out_weekend_activities_csv_gz <- './vista_2012_16_extracted_activities_weekend.csv.gz'
out_weekday_activities_tod_csv_gz <- './vista_2012_16_extracted_activities_weekday_by_min.csv.gz'
out_weekend_activities_tod_csv_gz <- './vista_2012_16_extracted_activities_weekend_by_min.csv.gz'

extract_activities_by_minute_of_day(out_weekend_activities_csv_gz, out_weekend_activities_tod_csv_gz)
#extract_activities_by_minute_of_day(out_weekday_activities_csv_gz, out_weekday_activities_tod_csv_gz)

```

```{r echo=FALSE}
in_activities_csv_gz<-'./vista_2012_16_extracted_activities_weekend_by_min.csv.gz'
gzfile<-in_activities_csv_gz
gz1 <- gzfile(gzfile,'rt')
activities<-read.csv(gz1,header = T,sep=',',stringsAsFactors = F,strip.white = T)
close(gz1)

# collapse data into 2hr blocks
blocksize<-24*4
df<-data.frame(row.names = seq(1:blocksize))
for (colname in colnames(activities)) {
  df[,colname]<-colSums(matrix(activities[,colname], ncol=blocksize))
}
#df$HourRange<-c("0-2","2-4","4-6","6-8","8-10","10-12","12-14","14-16","16-18","18-20","20-22","22-24")

d<-melt(t(df))
colnames(d)<-c("Activity", "HourRange", "Count")
ggplot(d, aes(HourRange,Count, col=Activity, fill=Activity)) + 
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  geom_bar(stat="identity", color="black", size=0.1, position = "stack") +
  xlab("Time of day") + ylab("Percentage of population") + 
  ggtitle(NULL)
```
